<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Calculations Lab — Advanced</title><link rel="stylesheet" href="styles.css"></head><body><div class="container"><div class="header"><div class="brand">☀️ Calculations Lab — Advanced</div><div class="nav"><a href="index.html">Dashboard</a><a href="syllabus.html">Syllabus</a><a href="practice.html">Practice</a><a href="calc.html" class="active">Calculations</a><a href="progress.html">Progress</a><a href="tests.html">Tests</a></div></div><main><div class="card"><div class="h1">Advanced Calculations</div><div class="small">Problems include combinations of + - * /, exponents, square roots, and sequence/pattern questions. Timer auto-starts on generation.</div><div style="margin-top:8px" class="row"><select id="mode" class="input"><option value="arithmetic">Arithmetic Mix</option><option value="sqrt">Square Root</option><option value="power">Exponents</option><option value="mixed">Mixed (all ops)</option><option value="pattern">Sequence / Pattern</option></select><select id="diff" class="input"><option>Easy</option><option>Medium</option><option>Hard</option><option>Insane</option></select><button id="gen" class="btn">Generate (auto-start)</button><button id="reveal" class="btn">Reveal</button></div><div style="margin-top:12px"><div id="q" class="h1">Press Generate</div><input id="ans" class="input" placeholder="Type your answer (use decimal for non-integers)"><div style="margin-top:8px" class="row"><button id="stop" class="btn">Stop</button><button id="submit" class="btn">Submit</button></div><div id="t" class="small" style="margin-top:8px">00:00.0</div></div></div><div class="card"><div class="h1">Attempts</div><div id="list" class="list small"></div></div></main><div class="footer"></div></div><script src="utils.js"></script><script>
function rnd(a,b){return Math.floor(Math.random()*(b-a+1))+a}
function fmt(ms){const s=Math.floor(ms/1000);const mm=String(Math.floor(s/60)).padStart(2,'0');const ss=String(s%60).padStart(2,'0');const t=Math.floor(ms%1000/100);return `${mm}:${ss}.${t}`}
let curQ='', curA=null, timer=null, start=0, elapsed=0;
function safeEval(expr){ try{ const e = expr.replace(/√\(/g,'Math.sqrt(').replace(/√([0-9]+)/g,'Math.sqrt($1)'); if(!/^[0-9+\-*/().\sMathsqrtpow,\^]*$/.test(e)) return null; const final = e.replace(/\^/g,'**'); return Function('return ('+final+');')(); }catch(e){return null;} }
function genArithmetic(level, allowOps){ const ops = allowOps; const terms = level==='Easy'?2: level==='Medium'?3: level==='Hard'?4:5; let expr=''; for(let i=0;i<terms;i++){ const n = rnd(1, level==='Easy'?20: level==='Medium'?50: level==='Hard'?120:200); expr += n; if(i<terms-1){ const op = ops[rnd(0,ops.length-1)]; expr += ' '+op+' '; } } const ans = safeEval(expr); return {q:expr, a:ans}; }
function genSqrt(level){ const n = rnd(level==='Easy'?2:level==='Medium'?4:level==='Hard'?9:12); const q = '√('+ (n*n) +')'; return {q:q, a: n}; }
function genPower(level){ const base = rnd(2, level==='Easy'?4: level==='Medium'?6: level==='Hard'?8:12); const exp = rnd(2, level==='Easy'?2: level==='Medium'?3: level==='Hard'?4:5); const q = base+'^'+exp; const a = safeEval(base+'**'+exp); return {q:q, a:a}; }
function genPattern(level){ const type = rnd(1,3); if(type===1){ const start = rnd(1,10); const diff = rnd(1, level==='Easy'?3: level==='Medium'?5:8); const seq = [start, start+diff, start+2*diff, start+3*diff]; return {q: seq.join(', ') + ', ?', a: start+4*diff}; } if(type===2){ const start = rnd(2,5); const r = rnd(2, level==='Easy'?3:level==='Medium'?4:5); const seq = [start, start*r, start*r*r, start*r*r*r]; return {q: seq.join(', ') + ', ?', a: start*Math.pow(r,4)}; } const start = rnd(1,7); const seq = [start*start+1, (start+1)*(start+1)+1, (start+2)*(start+2)+1, (start+3)*(start+3)+1]; return {q: seq.join(', ') + ', ?', a: (start+4)*(start+4)+1}; }
function generate(){ const mode = document.getElementById('mode').value; const diff=document.getElementById('diff').value; let res=null; if(mode==='arithmetic'){ res=genArithmetic(diff, ['+','-','*','/']); } else if(mode==='sqrt'){ res=genSqrt(diff); } else if(mode==='power'){ res=genPower(diff); } else if(mode==='mixed'){ res=genArithmetic(diff, ['+','-','*','/','^']); } else if(mode==='pattern'){ res=genPattern(diff); } curQ = res.q; curA = res.a; document.getElementById('q').textContent = curQ; document.getElementById('ans').value=''; if(timer) clearInterval(timer); start=Date.now(); elapsed=0; timer=setInterval(()=>{ elapsed=Date.now()-start; document.getElementById('t').textContent = fmt(elapsed); },100); }
document.getElementById('gen').addEventListener('click', generate);
document.getElementById('stop').addEventListener('click', ()=>{ if(timer) clearInterval(timer); timer=null; });
document.getElementById('reveal').addEventListener('click', ()=>{ if(curQ) document.getElementById('q').textContent = curQ + ' = ' + curA; });
document.getElementById('submit').addEventListener('click', ()=>{ if(timer) clearInterval(timer); timer=null; const user=document.getElementById('ans').value.trim(); const timeSec = Math.round((elapsed||0)/1000); const diff=document.getElementById('diff').value; const mode=document.getElementById('mode').value; let base = diff==='Easy'?10:diff==='Medium'?20:diff==='Hard'?40:80; if(mode==='pattern') base = base*1.2; const correct = (String(curA)===user) || (Math.abs((parseFloat(user)||0) - (parseFloat(curA)||0)) < 0.001); const points = correct ? Math.max(1, Math.round(base - Math.min(60, timeSec/2))) : 0; const arr = load('su_calc_attempts_v45', []); arr.push({q:curQ,ans:user,correct:correct?curA:null,time:timeSec,diff:diff,mode:mode,points:points,t:Date.now()}); save('su_calc_attempts_v45', arr); if(points>0) addXP(points,'calc'); alert(points>0?('Correct +'+points+' XP'):'Wrong — 0 XP'); document.getElementById('t').textContent='00:00.0'; render(); });
function render(){ const root=document.getElementById('list'); root.innerHTML=''; const arr=load('su_calc_attempts_v45', []).slice().reverse().slice(0,50); arr.forEach(a=>{ const d=document.createElement('div'); d.className='topic'; d.innerHTML = `<div><strong>${a.q}</strong><div class='small'>Your: ${a.ans} • Ans: ${a.correct===null? '—': a.correct} • ${a.mode} • ${a.diff} • ${a.time}s</div></div><div class='points'>${a.points}</div>`; const btns = document.createElement('div'); btns.style.display='flex'; btns.style.gap='6px'; const cor = document.createElement('button'); cor.className='btn'; cor.textContent='✅'; cor.title='Mark Correct'; cor.onclick = ()=>{ a.correct = a.correct===null? curA : a.correct; a.points = Math.max(1, Math.round((diffToBase(a.diff,a.mode)) - Math.min(60, a.time/2))); saveEdit(a); }; const ic = document.createElement('button'); ic.className='btn'; ic.textContent='❌'; ic.title='Mark Incorrect'; ic.onclick = ()=>{ a.correct = null; a.points = 0; saveEdit(a); }; const na = document.createElement('button'); na.className='btn'; na.textContent='⚪'; na.title='Not Attempted'; na.onclick = ()=>{ a.correct = null; a.points = 0; saveEdit(a); }; btns.appendChild(cor); btns.appendChild(ic); btns.appendChild(na); d.appendChild(btns); root.appendChild(d); }); }
function diffToBase(diff, mode){ let base = diff==='Easy'?10:diff==='Medium'?20:diff==='Hard'?40:80; if(mode==='pattern') base = base*1.2; return base; }
function saveEdit(item){ const arr = load('su_calc_attempts_v45', []); const idx = arr.findIndex(x=> x.t === item.t); if(idx>=0) arr[idx]=item; else arr.push(item); save('su_calc_attempts_v45', arr); render(); localStorage.setItem('su_calc_updated', Date.now()); }
render();
</script></body></html>